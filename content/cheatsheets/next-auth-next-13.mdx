---
title: Next-auth with NextJs 13.
description: Step by Step guide for using next-auth with NextJs 13.
date: 2022-11-23
---

<Callout>

The official website [next-auth](https://next-auth.js.org/) For this article in will go in brief and to the point. For more information check the official website.

</Callout>

<Callout>

IMPORTANT: While writing this cheat sheet I am using "next-auth": "^4.22.1", "@next-auth/prisma-adapter": "^1.0.6", "@prisma/client": "^4.13.0", "bcrypt": "^5.1.0", "next": "13.4.1", "prisma": "^4.13.0" and "@types/bcrypt": "^5.0.0".

</Callout>

## What is next-auth?

It is an [open-source](https://github.com/nextauthjs/next-auth) authentication solution for NextJs application. It is designed to support NextJs and serverless but runs anywhere (AWS Lambda, Docker, Heroku, etcâ€¦).
When you use Next-auth you also have control over the data. It can be used with or without a database.

> Note: Email sign-in requires a database to be configured to store single-use verification tokens.

## What is covered in this article?

Using next-auth in a NextJs 13 application with prisma. Since NextJs made the app directory stable and recommended we will be using that. The 2 ways we will use it are

1.  Using Credentials i.e. email and password.
2.  Social login with Google and Github.

## Getting Started

Before installing next-auth make sure you have your collection in the database. Once you have verified that it is out there you can follow the following steps.

## Run the following command

```html
npm install next-auth@latest @prisma/client @next-auth/prisma-adapter bcrypt
```

Version specific command:

```bash
npm install next-auth@4.22.1 @prisma/client@4.13.0 @next-auth/prisma-adapter@1.0.6 bcrypt@5.0.0
```

## Create prismadb.ts file inside libs folder

Location: app/libs/prismadb.ts

```ts
import { PrismaClient } from "@prisma/client";

declare global {
  var prisma: PrismaClient | undefined;
}

const client = globalThis.prisma || new PrismaClient();
if (process.env.NODE_ENV !== "production") globalThis.prisma = client;

export default client;
```

This code sets up a global prisma variable to hold an instance of PrismaClient.

## Creating the API route

> It is very important to name the following folder the way it is mention.

Inside your app folder there should be a folder called api. Inside the api folder create a folder called auth inside it another folder called [...nextauth] inside that route.ts

<Callout>Location: app/api/auth/[...nextauth]/route.ts</Callout>

<Image src="/images/guides/route.jpg" width="250" height="250" alt="Image" />

## Write the API route by following the video.

<Callout>

Make sure you pass the object "authOptions" not the type AuthOptions.

```ts
const handler = NextAuth(authOptions);
```

</Callout>

## Setting up the Environment variables

Go to your .env file write the following

```.env
NEXTAUTH_SECRET=
GITHUB_ID=
GITHUB_SECRET=

GOOGLE_CLIENT_ID=
GOOGLE_CLIENT_SECRET=
```

While writing the route above, if you changed the name of the environment variable write that.

> Double check for typo, it is a very common problem.

## Setting the value for NEXTAUTH_SECRET

For NEXTAUTH_SECRET you can put any string.

## Creating register API and functionality

Go back to api folder. Inside the api folder create another folder called register inside that route.ts

<Callout>Location: app/api/register/route.ts</Callout>

> Common Mistake: register folder is not inside auth folder.

Follow the video and write the register api.

Then go back to AuthForm and makes a POST request to the "/api/register" endpoint using the axios library.
For the code, follow the video or check Antonio's repo.

> Verification: Go to your auth form and register a new user. If everything is working properly a new user should be created in your database.

## Creating Login functionality

For login we have to call signIn function from next-auth. Also to log-in we have the option to use credentials or Social log-in i.e. Google and Github.

We have 3 providers to choose from (Credentials, Google and Github) since we wrote all the 3 in your [...nextauth]/route.ts

### Login with Credentials

Follow the video for the code. 

We call the signIn function from next-auth and pass 2 argument. First is the authentication method, which in this case is "credentials" and the second argument is an object that spreads the properties of the data object.

Continue from 1:48:22